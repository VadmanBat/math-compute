#include "nrcki/scheme.h"

#include "blocks/pulses/pulse.hpp"
#include "blocks/pulses/rising-pulse.hpp"
#include "blocks/pulses/falling-pulse.hpp"
#include "blocks/pulses/long-pulse.hpp"
#include "blocks/pulses/short-pulse.hpp"
#include "blocks/pulses/debounce-on.hpp"
#include "blocks/pulses/debounce-off.hpp"
#include "blocks/pulses/debounce-on-off.hpp"

namespace nrcki {
/**
 * Добавляет блок генерации импульса фиксированной длительности при изменении входа 0 -> 1.
 * Формирует импульс длительностью T при каждом положительном фронте входного сигнала.
 *
 * Применение:
 * <ul>
 *   <li>формирование управляющих сигналов фиксированной длительности;</li>
 *   <li>инициализация одноразовых операций;</li>
 *   <li>запуск таймеров и процессов с ограниченным временем выполнения.</li>
 * </ul>
 *
 * @param T длительность импульса [сек]
 */
void Scheme::addPulse(double T) {
    ++blocks_count;
    blocks.push_back(std::make_unique <Pulse>(*this, T));
}

/**
 * Добавляет блок единичного импульса по фронту (0 -> 1).
 * Формирует мгновенный импульс (длительностью 1 шаг интегрирования) при положительном фронте входного сигнала.
 *
 * Применение:
 * <ul>
 *   <li>счетчики событий;</li>
 *   <li>триггеры запуска процессов;</li>
 *   <li>обнаружение фронтов сигнала в системах управления.</li>
 * </ul>
 */
void Scheme::addRisingPulse() {
    ++blocks_count;
    blocks.push_back(std::make_unique <RisingPulse>(*this));
}

/**
 * Добавляет блок единичного импульса по спаду (1 -> 0).
 * Формирует мгновенный импульс (длительностью 1 шаг интегрирования) при отрицательном фронте входного сигнала.
 *
 * Применение:
 * <ul>
 *   <li>обнаружение окончания процессов;</li>
 *   <li>сигнализация об отключении оборудования;</li>
 *   <li>сброс триггеров и регистров.</li>
 * </ul>
 */
void Scheme::addFallingPulse() {
    ++blocks_count;
    blocks.push_back(std::make_unique <FallingPulse>(*this));
}

/**
 * Добавляет блок импульса с пролонгацией на время T.
 * Формирует импульс длительностью T, который продлевается при каждом новом положительном фронте входного сигнала.
 *
 * Применение:
 * <ul>
 *   <li>управление временем активности после последнего события;</li>
 *   <li>подсветка индикаторов при активности системы;</li>
 *   <li>поддержание состояния при периодической активности.</li>
 * </ul>
 *
 * @param T длительность продлеваемого импульса [сек]
 */
void Scheme::addLongPulse(double T) {
    ++blocks_count;
    blocks.push_back(std::make_unique <LongPulse>(*this, T));
}

/**
 * Добавляет блок импульса, который исчезает при входе 0.
 * Формирует импульс при положительном фронте, который немедленно сбрасывается при снятии входного сигнала.
 *
 * Применение:
 * <ul>
 *   <li>сигналы, требующие постоянного подтверждения;</li>
 *   <li>управление с принудительным сбросом при отсутствии сигнала;</li>
 *   <li>системы безопасности с непрерывным контролем.</li>
 * </ul>
 *
 * @param T длительность импульса при непрерывном сигнале [сек]
 */
void Scheme::addShortPulse(double T) {
    ++blocks_count;
    blocks.push_back(std::make_unique <ShortPulse>(*this, T));
}

/**
 * Добавляет блок импульса с подтверждением включения.
 * Формирует импульс только если входной сигнал сохраняется !=0 непрерывно в течение времени T.
 *
 * Применение:
 * <ul>
 *   <li>защита от ложных срабатываний при включении;</li>
 *   <li>системы с подтверждением намерения;</li>
 *   <li>критичные операции, требующие подтверждения.</li>
 * </ul>
 *
 * @param T минимальное время подтверждения [сек]
 */
void Scheme::addDebounce(double T, char type) {
    ++blocks_count;
    switch (type) {
        case 'e':
            blocks.push_back(std::make_unique <DebounceOn>(*this, T));
            break;
        case 'd':
            blocks.push_back(std::make_unique <DebounceOff>(*this, T));
            break;
        case 't':
            blocks.push_back(std::make_unique <DebounceOnOff>(*this, T));
            break;
    }
}

/**
 * Добавляет блок импульса с подтверждением выключения.
 * Формирует импульс при снятии входного сигнала, только если он сохранялся =0 непрерывно в течение времени T.
 *
 * Применение:
 * <ul>
 *   <li>подтверждение окончательного отключения систем;</li>
 *   <li>фиксация длительных перерывов в работе;</li>
 *   <li>сигнализация о завершении процессов с задержкой.</li>
 * </ul>
 *
 * @param T минимальное время подтверждения [сек]
 */

/**
 * Добавляет блок импульса с подтверждением как включения, так и выключения.
 * Формирует импульс:
 *   - При подтверждении включения (вход !=0 непрерывно в течение T)
 *   - При подтверждении выключения (вход =0 непрерывно в течение T)
 *
 * Применение:
 * <ul>
 *   <li>двухэтапные системы безопасности;</li>
 *   <li>управление оборудованием с подтверждением команд;</li>
 *   <li>системы с защитой от случайных срабатываний.</li>
 * </ul>
 *
 * @param T минимальное время подтверждения для обоих состояний [сек]
 */
}