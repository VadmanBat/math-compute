#include "../../../include/nrcki/scheme.h"

#include "blocks/interpolation/piecewise-linear.hpp"

namespace nrcki {
/**
 * Добавляет блок кусочно-линейной статической характеристики (PiecewiseLinear) на схему.
 * Реализует функцию вида y = f(x) с заданными точками излома.
 *
 * Характеристика строится по набору опорных точек (x[i], y[i]).
 * Между точками используется линейная интерполяция.
 *
 * Асимптотика вычислений:
 *   - При n < 16: O(n) (линейный поиск)
 *   - При n >= 16: O(log n) (бинарный поиск)
 *
 * Поведение за пределами заданного диапазона:
 *   - При is_extra_bound = true: линейная экстраполяция по последнему отрезку
 *   - При is_extra_bound = false: возвращается ближайшее граничное значение
 *
 * Применение:
 * <ul>
 *   <li>аппроксимация нелинейных характеристик датчиков;</li>
 *   <li>линеаризация статических зависимостей;</li>
 *   <li>реализация табличных преобразований сигналов;</li>
 *   <li>моделирование характеристик нелинейных элементов.</li>
 * </ul>
 *
 * @param n количество точек характеристики
 * @param x массив значений аргумента (длины n)
 * @param y массив значений функции (длины n)
 * @param is_extra_bound флаг обработки значений вне диапазона:
 *        - true: линейная экстраполяция
 *        - false: использование граничных значений
 *
 * @note Точки должны быть отсортированы по возрастанию x
 * @note Массивы x и y должны иметь одинаковую длину n
 * @note При n < 16 используется линейный поиск, при n >= 16 - бинарный
 */
void Scheme::addPiecewiseLinear(int n, double* x, double* y, bool is_extra_bound) {
    ++blocks_count;
    blocks.push_back(std::make_unique <PiecewiseLinear>(*this,
                                                        std::vector <types::real>(x, x + n),
                                                        std::vector <types::real>(y, y + n),
                                                        is_extra_bound
                     )
    );
}
}